

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Le routing &mdash; documentation Documentation GCsystem 1</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="documentation Documentation GCsystem 1" href="../index.html"/>
        <link rel="up" title="Pour commencer" href="index.html"/>
        <link rel="next" title="Les objets Request et Response" href="request-response.html"/>
        <link rel="prev" title="Le parefeu" href="firewall.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Documentation GCsystem
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Pour commencer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture du GCsystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#organisation-du-framework">Organisation du Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#cheminement-d-une-requete">Cheminement d&#8217;une requête</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install.html#installation-avec-composer">Installation avec Composer</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#installation-avec-github-et-composer">Installation avec Github et Composer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#connexion-a-la-base-de-donnees">Connexion à la base de données</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#parefeu">Parefeu</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#antispam">Antispam</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#encodage">Encodage</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#repertoire-racine">Répertoire racine</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#langue-par-defaut">Langue par défaut</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#choix-de-l-environnement">Choix de l&#8217;environnement</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#maintenance">Maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#profiler">Profiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#echappement-des-variables-superglobales">Échappement des variables superglobales</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#constantes-utilisateur">Constantes utilisateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#cache">Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#logs">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#affichage-des-erreurs">Affichage des erreurs</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#minifier-sortie-html">Minifier sortie html</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#asset-manager">Asset manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#chemins-vers-les-ressources-web">Chemins vers les ressources web</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spam.html">L&#8217;anti spam</a></li>
<li class="toctree-l2"><a class="reference internal" href="firewall.html">Le parefeu</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Le routing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creation-de-routes">Création de routes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creation-d-une-route-simple">Création d&#8217;une route simple</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gestion-des-routes-a-parametres-variables">Gestion des routes à paramètres variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gestion-des-groupes-de-routes">Gestion des groupes de routes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#restreindre-l-acces-a-une-url">Restreindre l&#8217;accès à une url</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connexion-de-l-utilisateur">Connexion de l&#8217;utilisateur</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statut-de-l-utilisateur">Statut de l&#8217;utilisateur</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="request-response.html">Les objets Request et Response</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller.html">Les contrôleurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html">Les modèles</a></li>
<li class="toctree-l2"><a class="reference internal" href="view.html">Les vues</a></li>
<li class="toctree-l2"><a class="reference internal" href="orm.html">L&#8217;Orm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Notions avancées</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutoriaux</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/blog/index.html">Création d&#8217;un blog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../helper/index.html">Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helper/pagination.html">Pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helper/mail.html">Mails</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other/index.html">Autre</a><ul class="simple">
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Documentation GCsystem</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Pour commencer</a> &raquo;</li>
      
    <li>Le routing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/getting-started/routing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="le-routing">
<h1>Le routing<a class="headerlink" href="#le-routing" title="Lien permanent vers ce titre">¶</a></h1>
<p>Une fois que vous avez correctement configuré le framework, il serait intéressant de pouvoir commencer à créer vos propres pages. Et la première pierre de votre site passera immanquablement par la création de nouvelles urls. Nous allons donc ici vous présenter en détail le système de routing.</p>
<p>Chaque module que vous créez dans le répertoire <code class="docutils literal"><span class="pre">src</span></code> possède son propre fichier de routing pour des raisons de lisibilité. Ce fichier nommé <code class="docutils literal"><span class="pre">route.xml</span></code> est situé dans le sous répertoire <code class="docutils literal"><span class="pre">src/module/resource/config/</span></code>. Voici un exemple d&#8217;un fichier de routing :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;root&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;index&quot;</span> <span class="na">url=</span><span class="s">&quot;(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;index.default&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;get&quot;</span> <span class="na">url=</span><span class="s">&quot;/form(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;index.get&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;gcs&quot;</span> <span class="na">url=</span><span class="s">&quot;/gcs&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;lang.default&quot;</span> <span class="na">url=</span><span class="s">&quot;/lang(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;lang.default&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;profiler.default&quot;</span> <span class="na">url=</span><span class="s">&quot;/profiler(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;profiler.default&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/root&gt;</span>
</pre></div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce fichier est composé de deux balises différentes : les balises <code class="docutils literal"><span class="pre">route</span></code> et les balises <code class="docutils literal"><span class="pre">group</span></code>. Les balises route servent à représenter une url donnée tandis que les balises group permettent d&#8217;encapsuler des routes possédents des attributs communs (noms proches, urls proches etc.).</p>
<p>Ces deux balises possèdent les mêmes attributs :</p>
<ul class="simple">
<li><strong>name</strong> : il s&#8217;agit du nom de la route. Attention, toutes les routes d&#8217;un même module doivent avoir des noms différents. En revanche, les routes provenant de modules différents peuvent avoir des noms en commun.</li>
<li><strong>url</strong> : il s&#8217;agit de l&#8217;url de la route.</li>
<li><strong>vars</strong> : pour chaque url, vous pouvez préciser des parties variables.</li>
<li><strong>action</strong> : cet attribut précise quelle action de quel controller devra être invoquée.</li>
<li><strong>method</strong> : il est possible de limiter la méthode d&#8217;accès à certaines pages parmi : get, post, put et delete.</li>
<li><strong>access</strong> : il est aussi possible de limiter l&#8217;accès à une url pour certains types d&#8217;utilisateurs.</li>
<li><strong>logged</strong> : on peut aussi dire si la page peut-être vu en étant connecté ou non.</li>
<li><strong>cache</strong> : il est possible d&#8217;enregistrer un cache totale de la page (cache html) en précisant le temps de mise en cache en seconde.</li>
</ul>
</div>
<div class="section" id="creation-de-routes">
<h2>Création de routes<a class="headerlink" href="#creation-de-routes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="creation-d-une-route-simple">
<h3>Création d&#8217;une route simple<a class="headerlink" href="#creation-d-une-route-simple" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous souhaitons créer une page d&#8217;accueil d&#8217;un blog sans aucun paramètre permettant d&#8217;appeler l&#8217;action <code class="docutils literal"><span class="pre">index</span></code> du controller <code class="docutils literal"><span class="pre">blog</span></code>. Cette page ne peut être vue que en GET. Nous écrirons alors :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;blog&quot;</span> <span class="na">url=</span><span class="s">&quot;/blog&quot;</span> <span class="na">action=</span><span class="s">&quot;blog.index&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Il est important de souligner que toutes les urls doivent absolument commencer par un <code class="docutils literal"><span class="pre">/</span></code>. De plus dans l&#8217;attribut action, il faut séparer le nom du controller de l&#8217;action par un <code class="docutils literal"><span class="pre">.</span></code>.</p>
</div>
<div class="section" id="gestion-des-routes-a-parametres-variables">
<h3>Gestion des routes à paramètres variables<a class="headerlink" href="#gestion-des-routes-a-parametres-variables" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il arrive très souvent que vous ayez besoin de rajouter des parties variables dans vos urls. Pour cela, le routeur du GCS s&#8217;appuie sur la syntaxe des Regex. Imaginons par exemple une route permettant d&#8217;afficher un article d&#8217;un blog. Cette route devra contenir le numéro de l&#8217;article ainsi que son titre. L&#8217;url sera donc :</p>
<div class="code html highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="o">=</span><span class="s">&quot;/blog/article/([0-9]+)/(.+)&quot;</span>
</pre></div>
</div>
<p>Maintenant que l&#8217;url est écrire, il ne reste plus qu&#8217;à préciser au framework quelles sont les parties variables. Pour cela, nous utilisons l&#8217;attribut <code class="docutils literal"><span class="pre">vars</span></code>. Il suffit d&#8217;y lister dans leur ordre d&#8217;apparition le nom des variables que vous voulez créer et le framework se chargera d&#8217;associer à chaque variable la bonne valeur :</p>
<div class="code html highlight-python"><div class="highlight"><pre><span class="nb">vars</span><span class="o">=</span><span class="s">&quot;id,title&quot;</span>
</pre></div>
</div>
<p>Grâce à cette ligne, le GCS va créer dans le tableau <code class="docutils literal"><span class="pre">$_GET</span></code> les clefs <code class="docutils literal"><span class="pre">id</span></code> et <code class="docutils literal"><span class="pre">title</span></code>. Nous obtenons donc au final la route suivante :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;blog.article&quot;</span> <span class="na">url=</span><span class="s">&quot;/blog/article/([0-9]+)/(.+)&quot;</span> <span class="na">vars=</span><span class="s">&quot;id,title&quot;</span> <span class="na">action=</span><span class="s">&quot;blog.article&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="gestion-des-groupes-de-routes">
<h3>Gestion des groupes de routes<a class="headerlink" href="#gestion-des-groupes-de-routes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il arrive parfois que vous ayez de nombreuses urls avec des points communs. Dans ce cas, il devient vite fastidieux d&#8217;écrire les parties redondantes. Pour éviter cela, le GCS propose l&#8217;utilisation des groupes. Imaginons alors l&#8217;exemple du CRUD. Nous avons dans un module 4 action permettant de lister, créer, modifier et supprimer des données. Ces urls ont beaucoup de points communs (name, url, action, logged, access, method et cache). Nous écrirons alors :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;crud&quot;</span> <span class="na">url=</span><span class="s">&quot;/crud&quot;</span> <span class="na">action=</span><span class="s">&quot;crud&quot;</span> <span class="na">method=</span><span class="s">&quot;*&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">url=</span><span class="s">&quot;(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;home&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;insert&quot;</span> <span class="na">url=</span><span class="s">&quot;/insert(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;insert&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;update&quot;</span> <span class="na">url=</span><span class="s">&quot;/update/([0-9]+)(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;update&quot;</span> <span class="na">vars=</span><span class="s">&quot;id&quot;</span> <span class="na">method=</span><span class="s">&quot;put&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;delete&quot;</span> <span class="na">url=</span><span class="s">&quot;/delete/([0-9]+)(/*)&quot;</span> <span class="na">action=</span><span class="s">&quot;delete&quot;</span> <span class="na">vars=</span><span class="s">&quot;id&quot;</span> <span class="na">method=</span><span class="s">&quot;delete&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/group&gt;</span>
</pre></div>
</div>
<p>Vous pouvez remarquer que les attributs name, url et action vons se concatener tandis que l&#8217;attribut methode de la balise group va être remplacer par l&#8217;attribut method de ses enfants.</p>
</div>
</div>
<div class="section" id="restreindre-l-acces-a-une-url">
<h2>Restreindre l&#8217;accès à une url<a class="headerlink" href="#restreindre-l-acces-a-une-url" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il existe deux façons de protéger l&#8217;accès à vos page :</p>
<ul class="simple">
<li>vérifier si l&#8217;utilisateur est connecté ou non</li>
<li>vérifier si l&#8217;utilisateur connecté possède les droits adéquats</li>
</ul>
<div class="section" id="connexion-de-l-utilisateur">
<h3>Connexion de l&#8217;utilisateur<a class="headerlink" href="#connexion-de-l-utilisateur" title="Lien permanent vers ce titre">¶</a></h3>
<p>La vérification de la connexion de l&#8217;utilisateur se fait via l&#8217;attribut <code class="docutils literal"><span class="pre">logged</span></code>. Il peut prendre trois valeurs : <code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">false</span></code> ou <code class="docutils literal"><span class="pre">*</span></code> (les deux). Si cet attribut n&#8217;est pas renseigné pour une route, la valeur par défaut est <code class="docutils literal"><span class="pre">*</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;blog&quot;</span> <span class="na">url=</span><span class="s">&quot;/blog&quot;</span> <span class="na">action=</span><span class="s">&quot;blog.index&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">logged=</span><span class="s">&quot;*&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="statut-de-l-utilisateur">
<h3>Statut de l&#8217;utilisateur<a class="headerlink" href="#statut-de-l-utilisateur" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si jamais vous voulez que l&#8217;utilisateur soit connecté pour accéder à une page, vous pouvez, en relation avec les rôles écrits dans le parefeu, préciser quels utilisateurs peuvent voire cette page en les listant dans l&#8217;attribut <code class="docutils literal"><span class="pre">access</span></code> :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;route</span> <span class="na">name=</span><span class="s">&quot;blog&quot;</span> <span class="na">url=</span><span class="s">&quot;/blog&quot;</span> <span class="na">action=</span><span class="s">&quot;blog.index&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">logged=</span><span class="s">&quot;true&quot;</span> <span class="na">access=</span><span class="s">&quot;ADMIN,USER&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="request-response.html" class="btn btn-neutral float-right" title="Les objets Request et Response" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="firewall.html" class="btn btn-neutral" title="Le parefeu" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, fabsgc.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>